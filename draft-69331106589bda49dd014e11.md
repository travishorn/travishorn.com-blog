---
title: "Why Apache is Returning 200 OK Instead of 304 Not Modified"
slug: why-apache-is-returning-200-ok-instead-of-304-not-modified

---

I recently ran into a frustrating caching issue with Apache. I requested a page where the request headers included `If-Modified-Since` and the response headers included `Last-Modified`. Since the timestamps matched, the server *should* have responded with a **304 Not Modified** (and no content). Instead, it kept responding with a **200 OK** and the full content payload.

Here is how I went down the rabbit hole to fix it.

## The Investigation

First, I discovered that Apache prioritizes `If-None-Match` over `If-Modified-Since`. My request headers did indeed include `If-None-Match`, and the response headers included an `ETag`. Even though the values seemed to match, I was still getting a **200 OK**.

Then I remembered I had enabled compression (mod\_deflate) using `AddOutputFilterByType`.

It turns out that when Gzip compression is enabled, Apache appends a `-gzip` suffix to the ETag. This suffix was present in both my `If-None-Match` sent by the client and the `ETag` returned by the server. So, why was the cache validation still failing?

## The Root Cause

The issue lies in Apache's order of operations. Apache calculates the ETag for the underlying file and compares it to the client's header *before* it applies compression.

The flow looks like this:

1. **Receive Request:** Client sends `If-None-Match: "12345-gzip"`.
    
2. **Calculate ETag:** Apache calculates the ETag for the uncompressed file: `"12345"`.
    
3. **Compare:** Apache compares `"12345-gzip"` (Client) vs `"12345"` (Server).
    
4. **Result:** No match.
    
5. **Process Response:** Apache compresses the file and appends `-gzip` to the ETag.
    
6. **Send:** Apache sends **200 OK** with `ETag: "12345-gzip"`.
    

Because the suffix is added *after* the comparison, the client’s ETag will never match the server’s calculated ETag.

## The Solution

The solution is to simply disable ETags when compression is active, forcing the browser and server to rely on the `If-Modified-Since` header instead.

Inside your `<IfModule mod_deflate.c>` block, add `FileETag None`:

```apache
    <IfModule mod_deflate.c>
    # ... your compression settings ...
    AddOutputFilterByType DEFLATE text/plain text/html ...
    
    # Disable ETags so the server falls back to Last-Modified
    FileETag None
</IfModule>
  
```

With ETags removed, the client and server successfully fall back to `If-Modified-Since` and `Last-Modified`. Since those timestamps match, Apache finally respects the cache and returns the elusive **304 Not Modified**.